---
layout: post
title: TCP/IP学习总结
date: 2021-04-14
category: summary
---

## 一、网络基础知识

#### 1.OSI参考模型中各个分层的作用（“协议”定义每一层的“作用”）

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/001.png" alt="001" style="zoom:80%;" />

■ 应用层：为应用程序提供服务并规定应用程序中通信相关的细节。包括文件传输、电子邮件、远程登录（虚拟终端）等协议。

■ 表示层：将应用处理的信息转换为适合网络传输的格式，或将来自下一层的数据转换为上层能够处理的格式。因此它主要负责数据格式的转换。具体来说，就是将设备固有的数据格式转换为网络标准传输格式。不同设备对同一比特流解释的结果可能会不同。因此，使它们保持一致是这一层的主要作用。

■ 会话层：负责建立和断开通信连接（数据流动的逻辑通路），以及数据的分割等数据传输相关的管理。

■ 传输层：起着可靠传输的作用。只在通信双方节点上进行处理，而无需在路由器上处理。

■ 网络层：将数据传输到目标地址。目标地址可以是多个网络通过路由器连接而成的某一个地址。因此这一层主要负责寻址和路由选择。

■ 数据链路层：负责物理层面上互连的、节点之间的通信传输。例如与1个以太网相连的2个节点之间的通信。将0、1序列划分为具有意义的数据帧传送给对端（数据帧的生成与接收）。

■ 物理层：负责0、1比特流（0、1序列）与电压的高低、光的闪灭之间的互换。

#### 2.传输方式分类

（1）面向有连接型与面向无连接型。

（2）电路交换与分组交换。

（3）根据接收端数量分为单播、广播（广播域）、多播和任播（DNS根域名解析服务器）。

#### 3.地址特点：

（1）唯一性（MAC地址和IP地址都具有唯一性）

（2）层次性（只有IP地址具有层次性）：IP地址实现分层的方式有两个方面，一方面IP地址由网络号和主机号两部分组成（网络号相同说明处于同一个网段），另一方面网络号相同的主机在组织结构、提供商类型和地域分布上都比较集中，方便IP寻址。

（3）MAC寻址参考地址转发表（记录实际MAC地址本身），IP寻址参考路由控制表（记录集中网络号的IP地址）。

#### 4.网络构成要素（硬件设备）

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/002.png" alt="002" style="zoom:80%;" />

（1）网络接口卡（NIC）：也叫网络适配器、网卡、LAN卡。任何一台计算机连接网络时，必须要使用网卡。

（2）中继器：位于OSI参考模型第一层。提供多个端口服务的中继器被称作中继集线器或集线器（多口中继器）。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/003.png" alt="003" style="zoom:80%;" />

（3）网桥/2层交换机：位于OSI参考模型第二层。具有识别、临时存储数据帧的功能，网桥可以通过检查数据帧中的FCS数据位的值丢弃损坏数据，此外还能通过地址自学机制（MAC地址、硬件地址、物理地址、适配器地址）和过滤功能控制网络流量。交换集线器现在基本也属于网桥的一种。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/004.png" alt="004" style="zoom:80%;" />

（4）路由器/3层交换机：位于OSI参考模型的第三层。网桥是根据物理地址（MAC地址）进行处理，而路由器/3层交换机是根据IP地址进行处理。路由器有分担网络负荷的作用，有些路由器还具备一定的网络安全功能。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/005.png" alt="005" style="zoom:80%;" />

（5）4~7层交换机：负责处理OSI参考模型中从传输层至应用层的数据。负载均衡器就是4~7层交换机的一种。4~7层交换机的重要功能之一是带宽控制，此外还有广域网加速器、特殊应用访问加速以及防火墙等应用场景。

（6）网关：是OSI参考模型中负责将从传输层到应用层的数据进行转换和转发的设备，负责协议的转换与数据的转发。在同一种类型的协议之间转发数据叫做应用网关。代理服务器（Proxy Server）是网关的一种，即应用网关。防火墙是一款通过网关通信，针对不同应用提高安全性的产品。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/006.png" alt="006" style="zoom:80%;" />

## 二、TCP/IP基础知识

#### 1.TCP/IP协议群

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/007.png" alt="007" style="zoom:80%;" />

#### 2.互联网与TCP/IP的关系

互联网通信需要相应的网络协议，TCP/IP协议群为使用互联网而开发制定，即互联网的协议就是TCP/IP，TCP/IP就是互联网的协议。

#### 3.互联网结构

互联网每个网络由骨干网和末端网组成，每个网络之间通过NOC（网络操作中心）相连，异构网络（运营商不同导致网络连接方式和使用方法不同的网络）连接需要IX（网络交换中心）的支持。

#### 4.TCP/IP分层模型

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/008.png" alt="008" style="zoom:80%;" />

OSI参考模型注重“通信协议必要的功能是什么”，TCP/IP更强调“在计算机上实现协议应该开发哪种程序”。

（1）硬件（物理层）：TCP/IP的最底层是负责数据传输的硬件。

（2）网络接口层（数据链路层）：利用以太网中的数据链路层进行通信，因此数据接口层，也相当于让NIC起作用的“驱动程序（在操作系统与硬件之间起桥梁作用的软件）”。

（3）互联网层（网络层）：互联网层使用IP协议，相当于PSI模型中的第三层网络层。IP协议基于IP地址将分组数据包发送到目的主机。IP、ICMP和ARP属于此层。

（4）传输层：最主要的功能就是让应用程序之间实现通信。两个具有代表性的协议是TCP和UDP。TCP/IP分层中的互联网层与传输层的功能通常由操作系统提供，尤其是路由器必须实现通过互联网层转发分组数据包的功能。此外，连接互联网的所有主机跟路由器都必须实现IP功能。

（5）应用层（会话层以上的分层）：TCP/IP分层将OSI参考模型中的会话层、表示层和应用层的功能都集中到了应用程序中实现。TCP/IP应用的架构绝大多数属于客户端/服务端模型。WWW中的HTTP属于OSI应用层的协议，HTML属于表示层的协议；电子邮件用到的SMTP协议属于应用层，同时扩展电子邮件格式的MIME协议属于表示层；文件传输用到的FTP协议属于应用层；远程登录的TELNET和SSH协议属于应用层；网络管理使用的SNMP属于应用层协议，而用来查看SNMP保存的信息的MIB属于表示层协议。

## 三、数据链路

#### 1.数据链路的作用

数据链路，指OSI参考模型中的数据链路层。数据链路层的协议定义了通过通信媒介互联的设备之间传输的规范。数据链路层处理的数据不是单纯的0、1序列，而是把它们集合为一个叫做“帧”的块进行传输。数据链路可以被视为网络传输中的最小单位。

#### 2.网络拓扑

网络的连接和构成的形态成为网络拓扑，包括总线型、环型、星型和网状型等，实际网络由简单的拓扑结构组合而成。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/009.png" alt="009" style="zoom:67%;" />

#### 3.数据链路相关技术

（1）MAC地址

MAC地址用于识别数据链路中互连的节点，长48比特，结构如图所示。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/010.png" alt="010" style="zoom:50%;" />

（2）共享介质型网络

从通信介质的使用方法上看，网络可分为共享介质型和非共享介质型。

共享介质型网络指由多个设备共享一个通信介质的一种网络，设备之间使用同一个载波信道进行发送和接收。共享介质型网络中有两种介质访问控制方式，一种是争用方式，另一种是令牌传递方式。

（3）非共享介质网络

对介质采取专用的一种传输控制方式，网络中的每个站直连交换机，由交换机负责转发数据帧。此方式可以根据交换机的高级特性构建虚拟局域网（VLAN）、进行流量控制等，但致命弱点是一旦交换机发生故障，与之相连的所有计算机之间都无法通信。

（4）根据MAC地址转发

以太网交换机（交换集线器），是一种持有多个端口的网桥，它参考转发表，根据数据链路层中每个帧的目标MAC地址，决定从哪个网络接口发送数据。这种转发表是自动生成的，原理如图所示。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/011.png" alt="011" style="zoom:50%;" />

交换机有存储转发和直通转发两种转发方式。存储转发检查以太网数据帧末尾的FCS位，避免错误帧。直通转发不接收整个帧，得知目标后即可开始转发，具有延迟较短的优势，但不可避免发送错误帧的可能性。

（5）环路检测技术

通过网桥链接网络时，如果出现环路，最坏的情况下会导致数据帧持续转发致使网络瘫痪，解决此问题，具体有生成树和源路由两种方式。

生成树方式规定每个网桥必须在每1~10秒内相互交换BPDU包，从而判断哪些端口使用哪些不使用，以便消除环路。

源路由法可以判断发送数据的源地址是通过哪个网桥实现传输的，并将帧写入RIF，网桥根据RIF信息发送帧给目标地址，在这种机制中发送端本身必须具备源路由功能。

（6）VLAN

采用带有VLAN技术的网桥，可以切断所有VLAN之间的所有通信，VLAN可以过滤多余的包，提高网络的承载效率。

如图所示，该交换机按照其端口区分了多个网段，从而区分了广播数据传播的范围、减少了网络负载并提高了网络的安全性。然而异构的两个网段之间，就需要利用具有路由功能的交换机（如三层交换机），或在各段中间通过路由器的连接才能实现通信。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/012.png" alt="012" style="zoom:50%;" />

#### 4.以太网

以太网规范简单，易于NIC及驱动程序实现，最早是由美国Xerox公司与前DEC公司设计的一种通信方式，之后由IEEE802.3委员会将其规范化，两者对以太网帧的格式定义有所不同，后者有时被称为802.3以太网。

（1）以太网连接形式

现在一般都采用终端与交换机之间独占电缆的方式实现以太网通信。

（2）以太网传输速度

以太网中以时钟频率决定传输速度，1K=1000，1M=1000K，1G=1000M。而在计算机内部采用二进制，因此以2^10表示最接近于1000的值，1K=1024，1M=1024K，1G=1024M。

（3）以太网帧格式

以太网帧由前导码和帧本体构成。

前导码如图所示，它由0、1数字交替组合而成，表示一个以太网帧的开始，也是对端网卡能够确保与其同步的标志，末尾是一个叫做SFD的域，值为“11”，之后就是以太网帧的本体，前导码和SFD共八个字节（8*8比特）。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/013.png" alt="013" style="zoom:50%;" />

以太网帧本体前端是以太网的首部，共14个字节，分别是6个字节的目标MAC地址、6个字节的源MAC地址以及2个字节的上层协议类型。首部后面是数据，容纳范围是46~1500个字节，帧尾有一个FCS占4个字节，检查此值可以将受噪声干扰的错误帧丢弃。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/014.png" alt="014" style="zoom:50%;" />

IEEE802.3以太网的帧本体稍有区别，如图所示，其中标识上一层协议类型的字段在SNAP中。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/015.png" alt="015" style="zoom:50%;" />

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/016.png" alt="016" style="zoom:50%;" />

在后面的VLAN中，帧的格式又有不同。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/017.png" alt="017" style="zoom:50%;" />

#### 5.无线通信

#### 6.PPP

（1）定义

PPP是指点对点，即1对1连接计算机的协议，相当于位于OSI参考模型第2层的数据链路层。PPP属于纯粹的数据链路层，与物理层没有任何关系，因此仅有PPP无法实现通信，还需要物理层的支持。前文的以太网则不仅与数据链路层有关，还与物理层有关。

（2）LCP和NCP

在开始进行数据传输前，要先建立一个PPP级的连接，当这个连接建立以后就可以进行身份认证、压缩与加密。PPP主要功能包括两个协议，一个是不依赖上层的LCP协议，另一个是依赖上层的NCP协议，如果上层为IP，则NCP也叫做IPCP。LCP主要负责建立和断开连接、设置最大接收单元（MRU）、设置验证协议（PAP或CHAP）以及设置是否进行通信质量的监控，而IPCP则负责IP地址设置以及是否进行TCP/IP首部压缩等设备。

通过PPP连接时，通常需要进行用户名密码的验证，并且对通信两端进行双方向的验证"。其验证协议有两种，分别为PAP和CHAP。PAP是PPP连接建立时，通过两次握手进行用户名和密码验证。其中密码以明文方式传输。因此一般用于安全要求并不很高的环境，否则会有窃听或盗用连接的危险。CHAP则使用一次性密码OTP，可以有效防止窃听。此外，在建立连接后还可以进行定期的密码交换，用来检验对端是否中途被替换。

（3）PPP的帧格式

PPP的数据帧格式如图所示，首尾有两个标志码“01111110”来区分每个帧，两个标志码中间不允许出现连续6个以上的“1”，发送时，出现连续5个“1”时后面必须插入一个“0”，接收时，删除连续5个“1”后面的“0”。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/018.png" alt="018" style="zoom:50%;" />

（4）PPPoE

通信线路由以太网模拟，采用PPPoE管理以太网连接，就可以利用PPP的验证等功能使各ISP有效管理终端用户的使用。

PPPoE的帧格式如图所示。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/018.png" alt="018" style="zoom:50%;" />

#### 7.其他数据链路

（1）ATM

ATM以一个信元（5字节首部加48字节数据）为单位进行传输，线路占用时间短，能高校传输大容量数据。

（2）

#### 8.公共网络



## 四、IP协议

#### 1.IP基础知识

#### 2.IP地址

#### 3.路由控制

#### 4.IP分割处理与再构成处理

#### 5.IPv6

IPv4 的地址长度为4个8位字节，即32比特，而IPv6的地址长度则是原来的4倍，即128比特，一般写成8个16位字节。
（1）IPv6具有以下几个特点：                            

①IP地址的扩大与路由控制表的聚合；②性能提升；③支持即插即用功能；④采用认证与加密功能；⑤多播、Mobile IP成为扩展功能。

（2）IPv6中IP地址的标记方法

#### 6.IPv4首部

IPv4首部格式如图所示。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/0.png" alt="0" style="zoom:50%;" />

（1）版本由4比特构成，表示标识IP首部的版本号。IPv4的版本号即为4，因此在这个字段上的值也是“4”。

（2）首部长度由4比特构成，表明IP首部的大小，单位为4字节（32比特）。对于没有可选项的P包，首部长度则设置为“5”。也就是说，当没有可选项时，IP首部的长度为20字节(4x5=20)。

（3）区分服务（TOS）由8比特构成，用来表明服务质量，本身可以再划分为DSCP段和ECN段，如图所示。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/0.png" alt="0" style="zoom:50%;" />

（4）总长度表示IP首部与数据部分合起来的总字节数，该字段长16比特，因此IP包的最大长度为65535（2^16）字节。虽然目前还不存在能够传输最大长度为65535字节的IP包的数据链路。但由于IP分片处理，从IP 的上一层的角度看，不论底层采用何种数据链路，都可以认为能够以IP的最大包长传输数据。

（5）标识由16比特构成，用于分片重组。同一个分片的标识值相同，不同分片的标识值不同。通常，每发送一个IP包，它的值也逐渐递增。

（6）标志由3比特构成，表示包被分片的相关信息。第一位未使用，现在必须是0。第二位指示是否进行分片，0表示可以分片，1表示不能分片。第三位在包被分片的情况下，表示是否为最后一个包，0表示最后一个分片的包，1表示分片中段的包。

（7）片偏移（FO）由13比特构成，用来标识被分片的每一个分段相对于原始数据的位置。第一个分片对应的值为0。由于FO域占13位，因此最多可以表示8192（2^13）个相对位置，单位为8字节，因此最大可表示相对于原始数据8×8192=65536字节的位置。

（8）生存时间（TTL）由8比特构成，它最初的意思是以秒为单位记录当前包在网络上应该生存的期限。然而，在实际中它是指可以中转多少个路由器的意思。每经过一个路由器，TTL会减少1，直到变成0则丢弃该包。

（9）协议由8比特构成，表示IP首部的下一个首部隶属于哪个协议。

（10）首部校验和由16比特（2个字节）构成，也叫IP首部校验和。该字段只校验数据报的首部，不校验数据部分，主要用来确保IP数据报不被破坏。
（11）源地址由32比特（4个字节）构成，表示发送端IP地址。

（12）目标地址由32比特（4个字节）构成，表示接收端IP地址。

（13）可选项长度可变，通常只在进行实验或诊断时使用。

（14）填充也称作填补物。在有可选项的情况下，首部长度可能不是32比特的整数倍。为此，通过向字段填充”0“，调整为32比特的整数倍。

（15）数据段用来存入数据，将IP上层协议的首部也作为数据进行处理。

#### 7.IPv6首部格式

IPv6首部格式如图所示。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/0.png" alt="0" style="zoom:50%;" />

（1）有效载荷长度指包的数据部分，不包括首部，若有可选项，其长度也算在有效载荷长度中。

（2）下一个首部相当于IPv4中的协议字段，通常表示IP的上一层协议是TCP或UDP，在有IPv6扩展首部的情况下，该字段表示后面第一个扩展首部的协议类型。

（3）跳数限制相当于IPv4的TTL。

（4）IPv6扩展首部

扩展首部介于IPv6首部与TCP/UDP首部中间，无字节限制，IPv6首部中没有标识以及标志字段，在需要对IP数据报进行分片时，可以使用扩展首部。

<img src="https://github.com/littleO-range/littleO-range.github.io/raw/master/_summaryimage/0.png" alt="0" style="zoom:50%;" />



## 五、IP协议相关技术

## 六、TCP与UDP

## 七、路由协议

## 八、应用协议

## 九、网络安全